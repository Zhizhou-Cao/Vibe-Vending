<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬æ—¶å¤šå·´èƒºè€è™æœº</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --machine-color: #ff4757;
            --machine-border: #2f3542;
            --gold: #ffd700;
            --bg-color: #1e272e;
        }

        body {
            background: var(--bg-color);
            background-image: radial-gradient(circle at 50% 50%, #2f3542 0%, #000 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 16px;
            user-select: none;
        }

        /* --- UI å±‚: ç¡¬å¸è®¡æ•° --- */
        .ui-layer {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(0,0,0,0.6);
            padding: 10px 20px;
            border-radius: 50px;
            border: 2px solid var(--gold);
            color: var(--gold);
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 0 15px var(--gold);
        }

        /* --- æ‰è½ç¡¬å¸ --- */
        .falling-coin {
            position: absolute;
            width: 50px;
            height: 50px;
            background: radial-gradient(circle at 30% 30%, #ffd700, #b8860b);
            border-radius: 50%;
            border: 3px solid #DAA520;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            cursor: pointer;
            z-index: 50;
            animation: fall linear forwards;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            color: #8B4513;
        }
        .falling-coin::after { content: '$'; }

        @keyframes fall {
            from { top: -60px; }
            to { top: 110vh; }
        }

        /* --- è€è™æœºä¸»ä½“ç»“æ„ --- */
        .machine-container {
            position: relative;
            display: flex;
            align-items: flex-end; /* è®©æ‹‰æ†åº•éƒ¨å¯¹é½ */
        }

        .slot-machine {
            background: var(--machine-color);
            width: 380px;
            height: 320px;
            border-radius: 40px 40px 20px 20px;
            border: 10px solid var(--machine-border);
            padding: 40px;
            box-shadow: inset 0 0 40px rgba(0,0,0,0.5), 0 20px 50px rgba(0,0,0,0.8);
            position: relative;
            z-index: 10;
        }

        .display-window {
            background: #fff;
            border: 8px solid #333;
            border-radius: 10px;
            height: 160px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 10px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
            background: linear-gradient(to bottom, #000 0%, #fff 20%, #fff 80%, #000 100%);
            overflow: hidden;
        }

        .reel {
            width: 90px;
            height: 120px;
            background: #f1f2f6;
            border: 2px solid #ced6e0;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3.5rem;
        }
        
        /* æ¨¡ç³ŠåŠ¨ç”» */
        .reel.spinning span {
            animation: blurScroll 0.15s infinite linear;
            display: block;
            filter: blur(4px);
        }
        @keyframes blurScroll {
            0% { transform: translateY(-50%) scaleY(1.2); opacity: 0.7; }
            100% { transform: translateY(50%) scaleY(1.2); opacity: 0.7; }
        }

        .status-light {
            width: 20px;
            height: 20px;
            background: #333;
            border-radius: 50%;
            margin: 20px auto 0;
            box-shadow: 0 0 5px #000;
            transition: 0.3s;
        }
        .status-light.ready { background: #2ed573; box-shadow: 0 0 15px #2ed573; }
        .status-light.error { background: #ff4757; box-shadow: 0 0 15px #ff4757; }

        /* --- éœ“è™¹ç‰ŒåŒ¾ --- */
        .neon-sign {
            position: relative;
            padding: 12px 28px;
            color: #ffeaa7;
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 2px;
            border: 2px solid rgba(255, 234, 167, 0.5);
            border-radius: 14px;
            text-shadow:
                0 0 6px #ffeaa7,
                0 0 12px #ff6b81,
                0 0 20px #ff6b81,
                0 0 28px #ff4757;
            box-shadow:
                0 0 12px rgba(255, 234, 167, 0.35),
                0 0 30px rgba(255, 107, 129, 0.35),
                inset 0 0 18px rgba(255, 234, 167, 0.08);
            background: rgba(0,0,0,0.35);
            backdrop-filter: blur(4px);
            animation: neonPulse 2s ease-in-out infinite;
        }
        @keyframes neonPulse {
            0%, 100% { opacity: 1; filter: drop-shadow(0 0 4px #ff6b81); }
            50% { opacity: 0.82; filter: drop-shadow(0 0 10px #ff4757); }
        }

        .cost-hint {
            text-align: center;
            color: white;
            margin-top: 10px;
            font-weight: bold;
            text-shadow: 0 2px 0 rgba(0,0,0,0.3);
        }

        /* --- æ‹‰æ†è£…ç½® --- */
        .lever-base {
            width: 30px;
            height: 100px;
            background: #57606f;
            border: 4px solid #2f3542;
            border-left: none;
            border-radius: 0 10px 10px 0;
            margin-bottom: 50px;
            position: relative;
        }

        .lever-arm {
            width: 15px;
            height: 150px;
            background: linear-gradient(to right, #ccc, #eee, #ccc);
            position: absolute;
            bottom: 40%;
            left: 10px;
            transform-origin: bottom center;
            transform: rotate(0deg);
            transition: transform 0.5s cubic-bezier(0.5, 0, 0.5, 1);
            cursor: pointer;
            z-index: 5;
        }

        .lever-knob {
            width: 50px;
            height: 50px;
            background: radial-gradient(circle at 30% 30%, #ff6b81, #c40b2a);
            border-radius: 50%;
            position: absolute;
            top: -25px;
            left: -17.5px;
            box-shadow: 0 5px 10px rgba(0,0,0,0.5);
        }
        
        .lever-arm:hover .lever-knob {
            filter: brightness(1.2);
        }

        /* æ‹‰åŠ¨åŠ¨ç”»ç±» */
        .lever-arm.pulled {
            transform: rotate(180deg); /* å‘ä¸‹æ‹‰åŠ¨ */
            transition: transform 0.3s ease-in;
        }
        .lever-arm.releasing {
            transform: rotate(0deg); /* å¼¹å› */
            transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* --- ä»»åŠ¡æ¨¡æ€æ¡† & äº’åŠ¨åŒºåŸŸ --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 200;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.5s;
        }
        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .game-container {
            background: #f1f2f6;
            width: 90%;
            max-width: 500px;
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 0 50px rgba(255,255,255,0.2);
        }

        .game-header { font-size: 1.5rem; margin-bottom: 15px; color: #333; }
        .game-content { margin-bottom: 20px; min-height: 200px; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        
        .finish-btn {
            background: #2ed573;
            border: none;
            padding: 10px 30px;
            border-radius: 10px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            display: none; /* é»˜è®¤éšè—ï¼Œä»»åŠ¡å®Œæˆæ˜¾ç¤º */
        }
        .finish-btn:hover { transform: scale(1.05); }
        
        #restartBtn:hover { transform: scale(1.05); }

        /* --- è¿·ä½ æ¸¸æˆæ ·å¼ --- */
        /* 1. æ‹¼å›¾ */
        .puzzle-grid {
            display: grid;
            grid-template-columns: repeat(3, 80px);
            grid-template-rows: repeat(3, 80px);
            gap: 2px;
            background: #333;
            padding: 5px;
        }
        .puzzle-piece {
            width: 80px; height: 80px;
            background-size: 240px 240px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .puzzle-piece:hover { opacity: 0.8; }
        
        /* 2. è®¡æ—¶å™¨ */
        .timer-circle {
            width: 150px; height: 150px;
            border-radius: 50%;
            border: 10px solid #ddd;
            border-top: 10px solid var(--machine-color);
            display: flex; justify-content: center; align-items: center;
            font-size: 2rem;
            animation: spinTimer 1s linear infinite;
            animation-play-state: paused;
        }
        @keyframes spinTimer { 100% { transform: rotate(360deg); } }

        /* 3. è®°å¿†ç¿»ç‰Œ */
        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 60px);
            gap: 10px;
        }
        .memory-card {
            width: 60px; height: 60px;
            background: #2f3542;
            border-radius: 5px;
            cursor: pointer;
            display: flex; justify-content: center; align-items: center;
            font-size: 0;
            transition: transform 0.3s;
        }
        .memory-card.flipped {
            background: #fff;
            font-size: 1.5rem;
            transform: rotateY(180deg);
        }
        .memory-card.matched {
            background: #2ed573;
            visibility: hidden;
            opacity: 0;
        }

    </style>
</head>
<body>

    <!-- UI -->
    <div class="ui-layer">
        <span>ğŸ’°</span>
        <span id="coinCount">0</span>
    </div>

    <!-- éœ“è™¹ç‰ŒåŒ¾ï¼ˆå¯ä¿®æ”¹æ–‡å­—ï¼‰ -->
    <div class="neon-sign" id="neonSign">âš¡ï¸é—ªç”µè¡¥ç»™ç«™âš¡ï¸</div>

    <!-- æ¸¸æˆæœºä¸»ä½“ -->
    <div class="machine-container">
        <div class="slot-machine">
            <div class="display-window">
                <div class="reel" id="reel0"><span>ğŸ’</span></div>
                <div class="reel" id="reel1"><span>ğŸ’</span></div>
                <div class="reel" id="reel2"><span>ğŸ’</span></div>
            </div>
            
            <div class="status-light" id="statusLight"></div>
            <div class="cost-hint">æ”¶é›† 3 æšç¡¬å¸ï¼Œæ‘‡åŠ¨æ‹‰æ†ğŸ‘‰</div>
        </div>

        <!-- æ‹‰æ† -->
        <div class="lever-base">
            <div class="lever-arm" id="leverArm" onclick="tryPullLever()">
                <div class="lever-knob"></div>
            </div>
        </div>
    </div>

    <!-- å¼¹çª—/ä»»åŠ¡åŒº -->
    <div class="modal-overlay" id="taskModal">
        <div class="game-container">
            <div class="game-header" id="gameTitle">ä»»åŠ¡æ ‡é¢˜</div>
            <div class="game-content" id="gameContent">
                <!-- åŠ¨æ€æ³¨å…¥æ¸¸æˆ/ä»»åŠ¡å†…å®¹ -->
            </div>
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 10px; flex-wrap: wrap;">
                <button class="finish-btn" id="finishBtn" onclick="closeTask()">âœ…å®Œæˆ</button>
                <button id="restartBtn" onclick="restartTask()" style="background: #ff6b81; border: none; padding: 10px 30px; border-radius: 10px; color: white; font-size: 1.2rem; cursor: pointer; transition: transform 0.2s;">ğŸ”„ é‡å¼€</button>
            </div>
        </div>
    </div>

    <script>
        // --- æ ¸å¿ƒçŠ¶æ€ ---
        let coins = 0;
        let isSpinning = false;
        let isTaskActive = false;
        let currentTask = null; // ä¿å­˜å½“å‰ä»»åŠ¡ï¼Œç”¨äºé‡å¼€
        let activeTimerInterval = null; // ä¿å­˜å½“å‰æ´»åŠ¨çš„å€’è®¡æ—¶å™¨
        const COST_TO_PLAY = 3;

        // --- DOM å…ƒç´  ---
        const coinDisplay = document.getElementById('coinCount');
        const statusLight = document.getElementById('statusLight');
        const leverArm = document.getElementById('leverArm');
        const reels = [document.getElementById('reel0'), document.getElementById('reel1'), document.getElementById('reel2')];
        const taskModal = document.getElementById('taskModal');
        const gameTitle = document.getElementById('gameTitle');
        const gameContent = document.getElementById('gameContent');
        const finishBtn = document.getElementById('finishBtn');

        // --- ä»»åŠ¡æ•°æ®åº“ (ä¿æŒ8ç±»ï¼Œå†…å®¹éšæœºåŒ–) ---
        const taskCategories = [
            { id: 'puzzle', icon: 'ğŸ§©', name: 'ç¢ç‰‡æ‹¼å›¾' },
            { id: 'memory', icon: 'ğŸƒ', name: 'è®°å¿†æŒ‘æˆ˜' },
            { id: 'breathe', icon: 'ğŸŒ¿', name: 'æ­£å¿µå‘¼å¸' },
            { id: 'sport', icon: 'ğŸ§˜', name: 'åŠ¨æ„Ÿæ—¶åˆ»' },
            { id: 'read', icon: 'ğŸ“–', name: 'çµæ„Ÿå¡ç‰‡' },
            { id: 'music', icon: 'ğŸµ', name: 'å¬è§‰SPA' },
            { id: 'eye', icon: 'ğŸ‘€', name: 'æŠ¤çœ¼è¡ŒåŠ¨' },
            { id: 'clean', icon: 'ğŸ§¹', name: 'å¾®è§‚æ¸…ç†' }
        ];

        // éšæœºå†…å®¹åº“ - å·¨å¤§çš„çŸ¥è¯†åº“
        const contentLib = {
            read: [
                "å¿ƒç†å­¦å†·çŸ¥è¯†ï¼šæ‹¥æŠ±è¶…è¿‡20ç§’ä¼šé‡Šæ”¾å‚¬äº§ç´ ï¼Œè®©äººæ„Ÿåˆ°æ›´ä¿¡ä»»å’Œå®‰å…¨ã€‚",
                "æ¯æ—¥æ–¯å¤šè‘›ï¼šæˆ‘ä»¬æ— æ³•æ§åˆ¶å‘ç”Ÿçš„äº‹ï¼Œä½†èƒ½æ§åˆ¶å¯¹å®ƒçš„ååº”ã€‚",
                "ä½ çŸ¥é“å—ï¼Ÿç« é±¼æœ‰ä¸‰ä¸ªå¿ƒè„ï¼Œä¹ä¸ªå¤§è„‘ï¼Œè¡€æ¶²æ˜¯è“è‰²çš„ã€‚",
                "çŸ­è¯—ï¼šè€Œåœ¨æˆ‘å¿ƒä¸­ï¼Œæœ‰ä¸€ä¸ªæ°¸ä¸æ²‰æ²¡çš„å¤å¤© â€”â€” åŠ ç¼ª",
                "ç§‘å­¦è¶£é—»ï¼šèœœèœ‚çš„ç¿…è†€æ¯ç§’å¯ä»¥æ‰‡åŠ¨200æ¬¡ï¼Œä½†å®ƒä»¬çš„ç¿…è†€å¤ªå°ï¼Œç†è®ºä¸Šé£ä¸èµ·æ¥ï¼Œä½†å®é™…å´èƒ½é£ï¼",
                "å“²å­¦æ€è€ƒï¼šçœŸæ­£çš„è‡ªç”±ä¸æ˜¯åšä½ æƒ³åšçš„äº‹ï¼Œè€Œæ˜¯ä¸åšä½ ä¸æƒ³åšçš„äº‹ã€‚",
                "ç”Ÿç‰©å¥‡è¿¹ï¼šæ°´æ¯æ²¡æœ‰å¤§è„‘ã€å¿ƒè„å’Œéª¨éª¼ï¼Œä½†å·²ç»åœ¨åœ°çƒä¸Šå­˜åœ¨äº†6.5äº¿å¹´ã€‚",
                "æ–‡å­¦é‡‘å¥ï¼š'ç”Ÿæ´»ä¸æ˜¯ç­‰å¾…æš´é£é›¨è¿‡å»ï¼Œè€Œæ˜¯å­¦ä¼šåœ¨é›¨ä¸­è·³èˆã€‚'",
                "å†å²å†·çŸ¥è¯†ï¼šå¤ç½—é©¬äººç”¨æµ·ç»µä»£æ›¿å«ç”Ÿçº¸ï¼Œè€Œä¸”è¿˜ä¼šé‡å¤ä½¿ç”¨ã€‚",
                "æ•°å­¦ä¹‹ç¾ï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—åœ¨è‡ªç„¶ç•Œä¸­éšå¤„å¯è§ï¼Œä»å‘æ—¥è‘µçš„ç§å­æ’åˆ—åˆ°è´å£³çš„èºæ—‹ã€‚",
                "å¿ƒç†å­¦ï¼š'é‚“å®-å…‹é²æ ¼æ•ˆåº”'å‘Šè¯‰æˆ‘ä»¬ï¼Œè¶Šæ— çŸ¥çš„äººè¶Šè‡ªä¿¡ã€‚",
                "å¤©æ–‡å­¦ï¼šå¦‚æœå¤ªé˜³çªç„¶æ¶ˆå¤±ï¼Œåœ°çƒè¦8åˆ†20ç§’åæ‰ä¼šçŸ¥é“ï¼Œå› ä¸ºå…‰é€Ÿæœ‰é™ã€‚",
                "æ–‡å­¦ï¼š'äººä¸æ˜¯ç”Ÿæ¥è¢«æ‰“è´¥çš„ï¼Œä¸€ä¸ªäººå¯ä»¥è¢«æ¯ç­ï¼Œä½†ä¸èƒ½è¢«æ‰“è´¥ã€‚' â€”â€” æµ·æ˜å¨",
                "ç§‘å­¦ï¼šäººç±»DNAå¦‚æœæ‹‰ç›´ï¼Œé•¿åº¦å¯ä»¥å¾€è¿”æœˆçƒ6000æ¬¡ã€‚",
                "å“²å­¦ï¼š'æœªç»å®¡è§†çš„äººç”Ÿä¸å€¼å¾—è¿‡ã€‚' â€”â€” è‹æ ¼æ‹‰åº•",
                "ç”Ÿç‰©å­¦ï¼šäººç±»å’Œé¦™è•‰å…±äº«50%çš„DNAã€‚",
                "å¿ƒç†å­¦ï¼š'å³°ç»ˆå®šå¾‹'å‘Šè¯‰æˆ‘ä»¬ï¼Œäººä»¬å¯¹ä½“éªŒçš„è®°å¿†ä¸»è¦å–å†³äºé«˜å³°å’Œç»“æŸæ—¶çš„æ„Ÿå—ã€‚",
                "å†å²ï¼šå¤åŸƒåŠæ³•è€å›¾å¦å¡è’™çš„å¢“ç©´è¢«å‘ç°æ—¶ï¼Œé‡Œé¢è¿˜æœ‰3500å¹´å‰çš„èœ‚èœœï¼Œä»ç„¶å¯ä»¥é£Ÿç”¨ã€‚",
                "æ–‡å­¦ï¼š'ä¸–ç•Œä»¥ç—›å»æˆ‘ï¼Œè¦æˆ‘æŠ¥ä¹‹ä»¥æ­Œã€‚' â€”â€” æ³°æˆˆå°”",
                "ç§‘å­¦ï¼šç« é±¼å¯ä»¥æ”¹å˜è‡ªå·±çš„é¢œè‰²å’Œçº¹ç†ï¼Œç”šè‡³æ¨¡ä»¿å…¶ä»–æµ·æ´‹ç”Ÿç‰©ã€‚",
                "å¿ƒç†å­¦ï¼š'é”šå®šæ•ˆåº”'è®©æˆ‘ä»¬åœ¨åšå†³å®šæ—¶è¿‡åº¦ä¾èµ–ç¬¬ä¸€å°è±¡ã€‚",
                "å¤©æ–‡å­¦ï¼šæœ¨æ˜Ÿçš„è´¨é‡æ˜¯å¤ªé˜³ç³»å…¶ä»–æ‰€æœ‰è¡Œæ˜Ÿè´¨é‡æ€»å’Œçš„2.5å€ã€‚",
                "æ–‡å­¦ï¼š'ç”Ÿæ´»å°±åƒä¸€ç›’å·§å…‹åŠ›ï¼Œä½ æ°¸è¿œä¸çŸ¥é“ä¸‹ä¸€é¢—æ˜¯ä»€ä¹ˆå‘³é“ã€‚'",
                "ç”Ÿç‰©å­¦ï¼šé²¨é±¼å·²ç»å­˜åœ¨äº†4äº¿å¹´ï¼Œæ¯”æé¾™è¿˜æ—©ã€‚",
                "å“²å­¦ï¼š'æˆ‘æ€æ•…æˆ‘åœ¨' â€”â€” ç¬›å¡å°”",
                "ç§‘å­¦ï¼šå¦‚æœæ‰€æœ‰äººç±»DNAé¦–å°¾ç›¸è¿ï¼Œå¯ä»¥å¾€è¿”å¤ªé˜³ç³»100æ¬¡ã€‚",
                "å¿ƒç†å­¦ï¼š'å¢¨è²å®šå¾‹'ï¼šå¦‚æœäº‹æƒ…å¯èƒ½å‡ºé”™ï¼Œå®ƒå°±ä¼šå‡ºé”™ã€‚",
                "å†å²ï¼šå¤ç½—é©¬çš„å…¬å…±å•æ‰€æ˜¯ç¤¾äº¤åœºæ‰€ï¼Œäººä»¬ä¼šè¾¹èŠå¤©è¾¹ä¸Šå•æ‰€ã€‚",
                "æ–‡å­¦ï¼š'æ—¶é—´ä¸åœ¨äºä½ æ‹¥æœ‰å¤šå°‘ï¼Œè€Œåœ¨äºä½ æ€æ ·ä½¿ç”¨ã€‚'",
                "ç§‘å­¦ï¼šäººç±»å¤§è„‘æ¯å¤©äº§ç”Ÿçº¦7ä¸‡ä¸ªæƒ³æ³•ã€‚"
            ],
            sport: [
                "ç«™èµ·æ¥ï¼åš10æ¬¡é«˜æŠ¬è…¿ã€‚",
                "æ‰¾ä¸€é¢å¢™ï¼Œåš20ç§’çš„é å¢™é™è¹²ã€‚",
                "é¢ˆéƒ¨æ”¾æ¾ï¼šç”¨å¤´åœ¨ç©ºä¸­ç”»'ç±³'å­—ï¼Œé‡å¤3æ¬¡ã€‚",
                "åš15ä¸ªæ·±è¹²ï¼Œæ„Ÿå—è…¿éƒ¨åŠ›é‡ã€‚",
                "åŸåœ°æ…¢è·‘30ç§’ï¼Œè®©å¿ƒè·³åŠ é€Ÿã€‚",
                "åš10ä¸ªä¿¯å§æ’‘ï¼ˆå¯ä»¥è·ªå§¿ï¼‰ã€‚",
                "æ‹‰ä¼¸ï¼šåŒæ‰‹ä¸¾è¿‡å¤´é¡¶ï¼Œå‘å·¦å³å„ä¾§å¼¯10ç§’ã€‚",
                "åš20ä¸ªå¼€åˆè·³ï¼Œæ¿€æ´»å…¨èº«ã€‚",
                "å¹³æ¿æ”¯æ’‘20ç§’ï¼Œå¼ºåŒ–æ ¸å¿ƒã€‚",
                "åš10ä¸ªå¼“æ­¥ï¼Œå·¦å³è…¿å„5æ¬¡ã€‚",
                "è¸®è„šå°–ç«™ç«‹30ç§’ï¼Œç„¶åæ”¾æ¾ã€‚",
                "åš15ä¸ªå·è…¹ï¼Œé”»ç‚¼è…¹éƒ¨ã€‚",
                "æ‰‹è‡‚ç”»å¤§åœˆï¼Œå‰åå„10æ¬¡ã€‚",
                "åš10ä¸ªè‡€æ¡¥ï¼Œæ¿€æ´»è‡€éƒ¨è‚Œè‚‰ã€‚",
                "åŸåœ°è¸æ­¥1åˆ†é’Ÿï¼Œä¿æŒèŠ‚å¥ã€‚",
                "åš20ä¸ªä¾§å¹³ä¸¾ï¼Œæ´»åŠ¨è‚©éƒ¨ã€‚",
                "å•è…¿ç«™ç«‹ï¼Œæ¯è…¿ä¿æŒ10ç§’å¹³è¡¡ã€‚",
                "åš10ä¸ªæ³¢æ¯”è·³ï¼ˆç®€åŒ–ç‰ˆä¹Ÿå¯ä»¥ï¼‰ã€‚",
                "æ‹‰ä¼¸å¤§è…¿å‰ä¾§ï¼Œæ¯è…¿ä¿æŒ15ç§’ã€‚",
                "åš15ä¸ªä»°å§èµ·åã€‚",
                "åŸåœ°é«˜æŠ¬è…¿30ç§’ã€‚",
                "åš10ä¸ªä¾§è¸¢ï¼Œå·¦å³å„5æ¬¡ã€‚",
                "åš20ä¸ªæ‰‹è‡‚å‰åæ‘†åŠ¨ã€‚",
                "åš10ä¸ªæ·±è¹²è·³ã€‚",
                "æ‹‰ä¼¸èƒŒéƒ¨ï¼šåŒæ‰‹æŠ±è†ï¼Œä¿æŒ15ç§’ã€‚",
                "åš15ä¸ªä¾§å§æŠ¬è…¿ï¼Œå·¦å³å„åšã€‚",
                "åš10ä¸ªç™»å±±è€…åŠ¨ä½œã€‚",
                "åš20ä¸ªæ‰‹è‡‚æ—‹è½¬ï¼Œå‰åå„10æ¬¡ã€‚",
                "åš10ä¸ªå•è…¿æ·±è¹²ï¼ˆå¯ä»¥æ‰¶å¢™ï¼‰ã€‚",
                "å…¨èº«æ‹‰ä¼¸ï¼šå‘ä¸Šä¼¸å±•ï¼Œä¿æŒ10ç§’ã€‚"
            ],
            music: [
                {
                    title: "çˆµå£«ä¹çš„èµ·æº",
                    description: "çˆµå£«ä¹èµ·æºäº20ä¸–çºªåˆçš„ç¾å›½æ–°å¥¥å°”è‰¯ï¼Œèåˆäº†éæ´²å’Œæ¬§æ´²çš„éŸ³ä¹å…ƒç´ ï¼Œå…·æœ‰å³å…´æ¼”å¥å’Œç‹¬ç‰¹çš„èŠ‚å¥ç‰¹ç‚¹ã€‚",
                    youtubeUrl: "https://www.youtube.com/watch?v=vmDDOFXSgAs"
                },
                {
                    title: "å¤å…¸éŸ³ä¹çš„ä¼˜é›…",
                    description: "å¤å…¸éŸ³ä¹æ˜¯è¥¿æ–¹éŸ³ä¹ä¼ ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä»å·´æ´›å…‹ã€å¤å…¸ä¸»ä¹‰åˆ°æµªæ¼«ä¸»ä¹‰ï¼Œæ¯ä¸ªæ—¶æœŸéƒ½æœ‰å…¶ç‹¬ç‰¹çš„é£æ ¼ã€‚",
                    youtubeUrl: "https://www.youtube.com/watch?v=jgpJVI3tDbY"
                },
                {
                    title: "è‡ªç„¶ä¹‹å£°çš„æ²»æ„ˆ",
                    description: "è‡ªç„¶å£°éŸ³å¦‚é›¨å£°ã€é¸Ÿé¸£ã€æµ·æµªç­‰ï¼Œå…·æœ‰å¤©ç„¶çš„æ²»æ„ˆæ•ˆæœã€‚ç ”ç©¶è¡¨æ˜ï¼Œè‡ªç„¶å£°éŸ³èƒ½å¤Ÿé™ä½å‹åŠ›ã€æ”¹å–„ç¡çœ è´¨é‡ã€‚",
                    youtubeUrl: "https://www.youtube.com/watch?v=jfKfPfyJRdk"
                },
                {
                    title: "è½»éŸ³ä¹çš„èˆ’ç¼“",
                    description: "è½»éŸ³ä¹ä»¥å…¶æŸ”å’Œçš„æ—‹å¾‹å’Œèˆ’ç¼“çš„èŠ‚å¥è‘—ç§°ï¼Œé€‚åˆåœ¨å·¥ä½œã€å­¦ä¹ æˆ–ä¼‘æ¯æ—¶è†å¬ï¼Œè¥é€ è½»æ¾æ„‰æ‚¦çš„æ°›å›´ã€‚",
                    youtubeUrl: "https://www.youtube.com/watch?v=4xDzrJKXOOY"
                },
                {
                    title: "ç”µå­éŸ³ä¹çš„ç°ä»£æ„Ÿ",
                    description: "ç”µå­éŸ³ä¹æ˜¯20ä¸–çºªåæœŸå‘å±•èµ·æ¥çš„éŸ³ä¹å½¢å¼ï¼Œåˆ©ç”¨ç”µå­ä¹å™¨å’Œæ•°å­—æŠ€æœ¯åˆ›é€ ç‹¬ç‰¹çš„éŸ³æ•ˆï¼Œä»£è¡¨ç°ä»£éŸ³ä¹çš„åˆ›æ–°ç²¾ç¥ã€‚",
                    youtubeUrl: "https://www.youtube.com/watch?v=60ItHLz5WEA"
                },
                {
                    title: "æ°‘è°£çš„æ¸©æš–",
                    description: "æ°‘è°£éŸ³ä¹ä»¥å…¶ç®€å•ã€çœŸæŒšçš„æ—‹å¾‹å’Œæ­Œè¯æ‰“åŠ¨äººå¿ƒã€‚å®ƒå¾€å¾€è®²è¿°æ™®é€šäººçš„æ•…äº‹ï¼Œè¡¨è¾¾å¯¹ç”Ÿæ´»çš„æ„Ÿæ‚Ÿã€‚",
                    youtubeUrl: "https://www.youtube.com/watch?v=NNAFaDtLm24"
                },
                {
                    title: "å†¥æƒ³éŸ³ä¹çš„å®é™",
                    description: "å†¥æƒ³éŸ³ä¹ä¸“é—¨è®¾è®¡ç”¨äºå¸®åŠ©äººä»¬è¿›å…¥æ·±åº¦æ”¾æ¾å’Œå†¥æƒ³çŠ¶æ€ï¼Œä½¿ç”¨ä½é¢‘ã€é‡å¤çš„æ—‹å¾‹ï¼Œå¼•å¯¼å¬è€…è¿›å…¥å†…å¿ƒçš„å®é™ç©ºé—´ã€‚",
                    youtubeUrl: "https://www.youtube.com/watch?v=1ZYbU82GVz4"
                },
                {
                    title: "é’¢ç´ç‹¬å¥çš„çº¯å‡€",
                    description: "é’¢ç´ç‹¬å¥ä»¥å…¶çº¯å‡€çš„éŸ³è‰²å’Œä¸°å¯Œçš„è¡¨ç°åŠ›è‘—ç§°ï¼Œèƒ½å¤Ÿä¼ è¾¾æ·±åˆ»çš„æƒ…æ„Ÿï¼Œæ˜¯éŸ³ä¹è‰ºæœ¯çš„é‡è¦å½¢å¼ã€‚",
                    youtubeUrl: "https://www.youtube.com/watch?v=7maJOI3QMu0"
                },
                {
                    title: "å¤ç­çš„ä¸œæ–¹éŸµå‘³",
                    description: "å¤ç­æ˜¯ä¸­å›½ä¼ ç»Ÿä¹å™¨ï¼ŒéŸ³è‰²æ¸…é›…æ‚ æ‰¬ï¼Œå…·æœ‰æµ“åšçš„ä¸œæ–¹æ–‡åŒ–éŸµå‘³ï¼Œèƒ½å¤Ÿå¸¦æ¥å¿ƒçµçš„å®é™ä¸å¹³å’Œã€‚",
                    youtubeUrl: "https://www.youtube.com/watch?v=iFlTZFanAWw"
                }
            ],
            breathe: [
                "è·Ÿéšåœ†åœˆå‘¼å¸ï¼šå¸æ°”4ç§’ï¼Œå±æ¯4ç§’ï¼Œå‘¼æ°”4ç§’ï¼Œé‡å¤å¾ªç¯ã€‚",
                "æ·±å‘¼å¸ç»ƒä¹ ï¼šç”¨é¼»å­æ·±å¸æ°”ï¼Œç”¨å˜´å·´æ…¢æ…¢å‘¼æ°”ï¼Œæ„Ÿå—è…¹éƒ¨èµ·ä¼ã€‚",
                "4-7-8å‘¼å¸æ³•ï¼šå¸æ°”4ç§’ï¼Œå±æ¯7ç§’ï¼Œå‘¼æ°”8ç§’ï¼Œé‡å¤4æ¬¡ã€‚",
                "æ­£å¿µå‘¼å¸ï¼šä¸“æ³¨äºå‘¼å¸ï¼Œå½“æ€ç»ªé£˜èµ°æ—¶ï¼Œæ¸©æŸ”åœ°æ‹‰å›æ³¨æ„åŠ›ã€‚",
                "è…¹å¼å‘¼å¸ï¼šå°†æ‰‹æ”¾åœ¨è…¹éƒ¨ï¼Œæ„Ÿå—å¸æ°”æ—¶è…¹éƒ¨é¼“èµ·ï¼Œå‘¼æ°”æ—¶æ”¶ç¼©ã€‚",
                "æ•°æ¯æ³•ï¼šä»1æ•°åˆ°10ï¼Œæ¯æ¬¡å‘¼æ°”æ•°ä¸€ä¸ªæ•°ï¼Œæ•°å®Œé‡æ–°å¼€å§‹ã€‚",
                "æµ·æµªå‘¼å¸ï¼šæƒ³è±¡å‘¼å¸å¦‚æµ·æµªèˆ¬èµ·ä¼ï¼Œè‡ªç„¶è€Œæœ‰èŠ‚å¥ã€‚",
                "èƒ½é‡å‘¼å¸ï¼šå¸æ°”æ—¶æƒ³è±¡å¸å…¥æ­£èƒ½é‡ï¼Œå‘¼æ°”æ—¶é‡Šæ”¾å‹åŠ›å’Œç´§å¼ ã€‚",
                "æ¸è¿›å¼æ”¾æ¾ï¼šé…åˆå‘¼å¸ï¼Œä»è„šè¶¾åˆ°å¤´é¡¶é€æ­¥æ”¾æ¾æ¯ä¸ªéƒ¨ä½ã€‚",
                "å†¥æƒ³å‘¼å¸ï¼šé™åï¼Œåªå…³æ³¨å‘¼å¸ï¼Œä¸åšä»»ä½•åˆ¤æ–­ã€‚"
            ],
            eye: [
                "è¿œçœº20ç§’ï¼Œç„¶åçœ‹è¿‘å¤„ï¼Œé‡å¤3æ¬¡ã€‚",
                "çœ¼çƒè½¬åŠ¨ï¼šé¡ºæ—¶é’ˆè½¬10åœˆï¼Œé€†æ—¶é’ˆè½¬10åœˆã€‚",
                "çœ¨çœ¼ç»ƒä¹ ï¼šå¿«é€Ÿçœ¨çœ¼20æ¬¡ï¼Œç„¶åé—­çœ¼ä¼‘æ¯10ç§’ã€‚",
                "è¿œè¿‘ç„¦ç‚¹åˆ‡æ¢ï¼šçœ‹è¿œå¤„ç‰©ä½“5ç§’ï¼Œå†çœ‹è¿‘å¤„5ç§’ï¼Œé‡å¤5æ¬¡ã€‚",
                "çœ¼éƒ¨æŒ‰æ‘©ï¼šç”¨æŒ‡è…¹è½»è½»æŒ‰æ‘©çœ¼å‘¨ç©´ä½ï¼Œæ¯ä¸ªç©´ä½10ç§’ã€‚",
                "8å­—çœ¼çƒè¿åŠ¨ï¼šç”¨çœ¼ç›ç”»æ¨ª8å­—ï¼Œå·¦å³å„5æ¬¡ã€‚",
                "çœ‹çª—å¤–çš„ç»¿è‰²æ¤ç‰©ï¼ŒæŒç»­30ç§’ã€‚",
                "æ‰‹æŒæ‚çœ¼ï¼šåŒæ‰‹æ“çƒ­åæ‚ä½çœ¼ç›ï¼Œæ„Ÿå—æ¸©æš–ï¼ŒæŒç»­1åˆ†é’Ÿã€‚",
                "ä¸Šä¸‹å·¦å³çœ‹ï¼šçœ¼çƒå‘ä¸Šä¸‹å·¦å³å„çœ‹5ç§’ï¼Œé‡å¤3æ¬¡ã€‚",
                "çœ¼éƒ¨æ‹‰ä¼¸ï¼šå‘ä¸Šçœ‹5ç§’ï¼Œå‘ä¸‹çœ‹5ç§’ï¼Œå·¦å³å„çœ‹5ç§’ã€‚",
                "é—­çœ¼ä¼‘æ¯ï¼šå®Œå…¨é—­ä¸Šçœ¼ç›ï¼Œæ”¾æ¾1åˆ†é’Ÿã€‚",
                "çœ¼çƒå¯¹è§’çº¿è¿åŠ¨ï¼šçœ‹å·¦ä¸Šè§’5ç§’ï¼Œå†çœ‹å³ä¸‹è§’5ç§’ï¼Œé‡å¤3æ¬¡ã€‚",
                "çœ¼éƒ¨çƒ­æ•·ï¼šæƒ³è±¡æ¸©æš–çš„å…‰ç…§åœ¨çœ¼ç›ä¸Šï¼ŒæŒç»­30ç§’ã€‚",
                "å¿«é€Ÿçœ¨çœ¼ï¼šå¿«é€Ÿçœ¨çœ¼10æ¬¡ï¼Œç„¶åé—­çœ¼ä¼‘æ¯ã€‚",
                "çœ¼çƒç”»åœ†ï¼šç”¨çœ¼ç›ç”»å¤§åœ†ï¼Œé¡ºæ—¶é’ˆå’Œé€†æ—¶é’ˆå„5æ¬¡ã€‚"
            ],
            clean: [
                "æ•´ç†æ¡Œé¢ï¼šæŠŠæ¡Œé¢ä¸Šçš„ç‰©å“å½’ä½ï¼Œä¿æŒæ•´æ´ã€‚",
                "æ¸…ç†æµè§ˆå™¨æ ‡ç­¾ï¼šå…³é—­ä¸éœ€è¦çš„æ ‡ç­¾é¡µï¼Œåªä¿ç•™é‡è¦çš„ã€‚",
                "æ•´ç†æ–‡ä»¶å¤¹ï¼šæŠŠæ¡Œé¢æˆ–ä¸‹è½½æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶åˆ†ç±»æ•´ç†ã€‚",
                "æ¸…ç†æ‰‹æœºé€šçŸ¥ï¼šæ¸…é™¤æ‰€æœ‰æœªè¯»é€šçŸ¥ï¼Œä¿æŒæ¸…çˆ½ã€‚",
                "æ•´ç†ä¹¦æ¡ŒæŠ½å±‰ï¼šæŠŠæŠ½å±‰é‡Œçš„ç‰©å“é‡æ–°æ‘†æ”¾æ•´é½ã€‚",
                "åˆ é™¤æ— ç”¨æ–‡ä»¶ï¼šæ¸…ç†ç”µè„‘æˆ–æ‰‹æœºä¸­ä¸éœ€è¦çš„æ–‡ä»¶ã€‚",
                "æ•´ç†ä¹¦æ¶ï¼šæŠŠä¹¦ç±æŒ‰ç…§ç±»å‹æˆ–å¤§å°é‡æ–°æ’åˆ—ã€‚",
                "æ¸…ç†é”®ç›˜ï¼šç”¨è½¯å¸ƒè½»è½»æ“¦æ‹­é”®ç›˜ï¼Œæ¸…é™¤ç°å°˜ã€‚",
                "æ•´ç†è¡£æŸœï¼šæŠŠæ•£è½çš„è¡£ç‰©æŒ‚å¥½æˆ–å å¥½ã€‚",
                "æ¸…ç†åƒåœ¾æ¡¶ï¼šå€’æ‰åƒåœ¾ï¼Œä¿æŒç¯å¢ƒæ•´æ´ã€‚",
                "æ•´ç†å……ç”µçº¿ï¼šæŠŠå„ç§å……ç”µçº¿æ•´ç†å¥½ï¼Œé¿å…ç¼ ç»•ã€‚",
                "æ¸…ç†æµè§ˆå™¨å†å²ï¼šæ¸…é™¤ä¸éœ€è¦çš„æµè§ˆè®°å½•ã€‚",
                "æ•´ç†ç…§ç‰‡ï¼šåˆ é™¤æ¨¡ç³Šæˆ–é‡å¤çš„ç…§ç‰‡ã€‚",
                "æ¸…ç†å†°ç®±ï¼šæ£€æŸ¥å¹¶æ¸…ç†è¿‡æœŸæˆ–ä¸éœ€è¦çš„é£Ÿç‰©ã€‚",
                "æ•´ç†åŒ…åŒ…ï¼šæŠŠåŒ…é‡Œçš„ç‰©å“é‡æ–°æ•´ç†ï¼Œä¿æŒæœ‰åºã€‚",
                "æ¸…ç†é‚®ä»¶ï¼šåˆ é™¤æˆ–å½’æ¡£ä¸éœ€è¦çš„é‚®ä»¶ã€‚",
                "æ•´ç†è¯ç®±ï¼šæ£€æŸ¥è¯å“æœ‰æ•ˆæœŸï¼Œæ•´ç†å¥½è¯ç®±ã€‚",
                "æ¸…ç†æ°´æ¯ï¼šæ¸…æ´—æ°´æ¯ï¼Œä¿æŒå¹²å‡€ã€‚",
                "æ•´ç†æŠ½å±‰ï¼šæŠŠæŠ½å±‰é‡Œçš„ç‰©å“åˆ†ç±»æ•´ç†ã€‚",
                "æ¸…ç†ç”µè„‘æ¡Œé¢ï¼šæ•´ç†æ¡Œé¢å›¾æ ‡ï¼Œä¿æŒæ•´æ´ã€‚"
            ],
            puzzle: [
                "æ‹¼å›¾æŒ‘æˆ˜ï¼šå®Œæˆä¸€ä¸ª3x3çš„æ‹¼å›¾æ¸¸æˆã€‚",
                "é€»è¾‘æ‹¼å›¾ï¼šé€šè¿‡äº¤æ¢æ–¹å—è¿˜åŸå›¾ç‰‡ã€‚",
                "æ•°å­—æ‹¼å›¾ï¼šå°†æ‰“ä¹±çš„æ•°å­—æ–¹å—æŒ‰é¡ºåºæ’åˆ—ã€‚",
                "å›¾æ¡ˆæ‹¼å›¾ï¼šå°†ç¢ç‰‡æ‹¼æˆå®Œæ•´å›¾æ¡ˆã€‚",
                "é¢œè‰²æ‹¼å›¾ï¼šæŒ‰ç…§é¢œè‰²è§„å¾‹æ’åˆ—æ–¹å—ã€‚"
            ],
            memory: [
                "è®°å¿†æŒ‘æˆ˜ï¼šè®°ä½å¹¶åŒ¹é…ç›¸åŒçš„å¡ç‰‡ã€‚",
                "æ•°å­—è®°å¿†ï¼šè®°ä½ä¸€ä¸²æ•°å­—å¹¶å¤è¿°ã€‚",
                "å›¾æ¡ˆè®°å¿†ï¼šè®°ä½å›¾æ¡ˆçš„ä½ç½®å¹¶åŒ¹é…ã€‚",
                "é¢œè‰²è®°å¿†ï¼šè®°ä½é¢œè‰²åºåˆ—å¹¶é‡å¤ã€‚",
                "ç¬¦å·è®°å¿†ï¼šè®°ä½ç¬¦å·çš„ä½ç½®å¹¶åŒ¹é…ã€‚"
            ]
        };

        // --- 1. ç¡¬å¸æ‰è½ç³»ç»Ÿ (PVZé£æ ¼) ---
        function spawnCoin() {
            if (isTaskActive) return; // ä»»åŠ¡ä¸­ä¸æ‰é’±

            const coin = document.createElement('div');
            coin.classList.add('falling-coin');
            // éšæœºæ°´å¹³ä½ç½® (10% - 90%)
            coin.style.left = (Math.random() * 80 + 10) + 'vw';
            // éšæœºåŠ¨ç”»æ—¶é•¿ (3s - 6s)
            coin.style.animationDuration = (Math.random() * 3 + 3) + 's';
            
            coin.onclick = function() {
                collectCoin(coin);
            };

            // åŠ¨ç”»ç»“æŸè‡ªåŠ¨é”€æ¯
            coin.addEventListener('animationend', () => {
                if(coin.parentNode) coin.remove();
            });

            document.body.appendChild(coin);
        }

        function collectCoin(el) {
            // ç®€å•çš„é£å‘UIåŠ¨ç”»é€»è¾‘ï¼ˆç®€åŒ–ç‰ˆï¼‰
            el.style.transition = 'all 0.5s';
            el.style.top = '20px';
            el.style.left = (window.innerWidth - 60) + 'px';
            el.style.opacity = '0';
            
            setTimeout(() => {
                coins++;
                updateUI();
                el.remove();
                // æ’­æ”¾éŸ³æ•ˆ (å¯é€‰)
            }, 500);
        }

        // æ¯ 2-5 ç§’æ‰ä¸€ä¸ªç¡¬å¸
        setInterval(() => {
            if (!document.hidden) spawnCoin();
        }, 3000);

        function updateUI() {
            coinDisplay.innerText = coins;
            if (coins >= COST_TO_PLAY && !isSpinning) {
                statusLight.classList.add('ready');
                statusLight.classList.remove('error');
            } else {
                statusLight.classList.remove('ready');
            }
        }

        // --- 2. æ‹‰æ†ä¸è€è™æœºé€»è¾‘ ---
        function tryPullLever() {
            if (isSpinning || isTaskActive) return;

            if (coins < COST_TO_PLAY) {
                // ä½™é¢ä¸è¶³åé¦ˆ
                statusLight.classList.add('error');
                setTimeout(() => statusLight.classList.remove('error'), 500);
                alert("ç¡¬å¸ä¸è¶³ï¼è¯·ç‚¹å‡»ç©ºä¸­æ‰è½çš„ç¡¬å¸æ”¶é›† (éœ€3æš)");
                return;
            }

            // æ‰£è´¹
            coins -= COST_TO_PLAY;
            updateUI();
            
            // æ‹‰æ†åŠ¨ç”»
            leverArm.classList.add('pulled');
            setTimeout(() => {
                leverArm.classList.remove('pulled');
                leverArm.classList.add('releasing');
                setTimeout(() => leverArm.classList.remove('releasing'), 600);
            }, 300);

            startSpin();
        }

        function startSpin() {
            isSpinning = true;
            statusLight.classList.remove('ready');

            // ç¡®å®šç»“æœ
            const targetTask = taskCategories[Math.floor(Math.random() * taskCategories.length)];
            const icons = ["ğŸ", "ğŸ‡", "ğŸ’", "7ï¸âƒ£", targetTask.icon];

            // å¯åŠ¨æ»šè½®
            reels.forEach(reel => {
                reel.classList.add('spinning');
                reel.innerHTML = `<span>${icons[Math.floor(Math.random()*icons.length)]}</span>`;
            });

            // åˆ†æ­¥åœæ­¢ (å¿ƒç†æš—ç¤º)
            const stopDelay = [1000, 1800, 2600];
            
            stopDelay.forEach((delay, index) => {
                setTimeout(() => {
                    reels[index].classList.remove('spinning');
                    reels[index].innerHTML = `<span>${targetTask.icon}</span>`;
                    // éœ‡åŠ¨åé¦ˆ
                    if(navigator.vibrate) navigator.vibrate(30);
                    
                    if (index === 2) {
                        setTimeout(() => launchTask(targetTask), 800);
                    }
                }, delay);
            });
        }

        // --- 3. ä»»åŠ¡ç”Ÿæˆå¼•æ“ ---
        function launchTask(task) {
            isSpinning = false;
            isTaskActive = true;
            currentTask = task; // ä¿å­˜å½“å‰ä»»åŠ¡
            taskModal.classList.add('active');
            gameTitle.innerText = `${task.icon} ${task.name}`;
            finishBtn.style.display = 'none'; // å…ˆéšè—å®ŒæˆæŒ‰é’®
            
            gameContent.innerHTML = ''; // æ¸…ç©ºæ—§å†…å®¹

            // æ ¹æ®ç±»å‹æ¸²æŸ“ä¸åŒçš„è¿·ä½ äº’åŠ¨ï¼Œä»çŸ¥è¯†åº“ä¸­éšæœºé€‰æ‹©å†…å®¹
            switch(task.id) {
                case 'puzzle':
                    initPuzzleGame();
                    break;
                case 'memory':
                    initMemoryGame();
                    break;
                case 'breathe':
                    // ä»çŸ¥è¯†åº“ä¸­éšæœºé€‰æ‹©å‘¼å¸ç»ƒä¹ å†…å®¹
                    const breatheText = contentLib.breathe[Math.floor(Math.random() * contentLib.breathe.length)];
                    initTimerTask(breatheText, 60);
                    break;
                case 'eye':
                    // ä»çŸ¥è¯†åº“ä¸­éšæœºé€‰æ‹©æŠ¤çœ¼å†…å®¹
                    const eyeText = contentLib.eye[Math.floor(Math.random() * contentLib.eye.length)];
                    // æ£€æŸ¥æ˜¯å¦åŒ…å«æ—¶é—´ï¼Œå¦‚æœæœ‰åˆ™ä½¿ç”¨initCheckTaskï¼Œå¦åˆ™ä½¿ç”¨initTimerTask
                    const eyeTime = extractTimeFromText(eyeText);
                    if (eyeTime && eyeTime > 0) {
                        initCheckTask(eyeText, 0);
                    } else {
                        initTimerTask(eyeText, 60);
                    }
                    break;
                case 'sport':
                    const sportText = contentLib.sport[Math.floor(Math.random() * contentLib.sport.length)];
                    initCheckTask(sportText, 5); // 5ç§’å€’è®¡æ—¶åå…è®¸å®Œæˆ
                    break;
                case 'clean':
                    const cleanText = contentLib.clean[Math.floor(Math.random() * contentLib.clean.length)];
                    initCheckTask(cleanText, 5);
                    break;
                case 'read':
                    const readText = contentLib.read[Math.floor(Math.random() * contentLib.read.length)];
                    gameContent.innerHTML = `<div style="font-size:1.2rem; line-height:1.6; text-align:left; padding:10px;">${readText}</div>`;
                    setTimeout(() => finishBtn.style.display = 'inline-block', 3000); // 3ç§’åæ‰ç®—è¯»å®Œ
                    break;
                case 'music':
                    const musicItem = contentLib.music[Math.floor(Math.random() * contentLib.music.length)];
                    gameContent.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <h3 style="font-size: 1.8rem; color: #333; margin-bottom: 15px; font-weight: bold;">${musicItem.title}</h3>
                            <div style="font-size: 1.1rem; line-height: 1.8; color: #555; text-align: left; padding: 20px; background: #f8f9fa; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                                ${musicItem.description}
                            </div>
                            <div style="margin-top: 25px;">
                                <a href="${musicItem.youtubeUrl}" target="_blank" style="display: inline-block; background: #ff0000; color: white; padding: 15px 40px; border-radius: 30px; text-decoration: none; font-size: 1.2rem; font-weight: bold; box-shadow: 0 4px 15px rgba(255,0,0,0.3); transition: transform 0.2s, box-shadow 0.2s;">
                                    ğŸµ è†å¬éŸ³ä¹ï¼Œä¼‘æ¯ä¸€ä¸‹
                                </a>
                            </div>
                            <div style="margin-top: 20px; font-size: 0.9rem; color: #888;">
                                ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è·³è½¬åˆ° YouTube æ’­æ”¾éŸ³ä¹
                            </div>
                        </div>
                    `;
                    // æ·»åŠ æ‚¬åœæ•ˆæœ
                    const musicLink = gameContent.querySelector('a');
                    if (musicLink) {
                        musicLink.onmouseover = function() {
                            this.style.transform = 'scale(1.05)';
                            this.style.boxShadow = '0 6px 20px rgba(255,0,0,0.4)';
                        };
                        musicLink.onmouseout = function() {
                            this.style.transform = 'scale(1)';
                            this.style.boxShadow = '0 4px 15px rgba(255,0,0,0.3)';
                        };
                    }
                    setTimeout(() => finishBtn.style.display = 'inline-block', 3000); // 3ç§’åæ˜¾ç¤ºå®ŒæˆæŒ‰é’®
                    break;
            }
        }

        // --- é‡å¼€åŠŸèƒ½ï¼šå…è´¹é‡æ–°æŠ½å¥– ---
        function restartTask() {
            if (!currentTask || isSpinning) return;
            
            // æ¸…ç†å€’è®¡æ—¶å™¨
            if (activeTimerInterval) {
                clearInterval(activeTimerInterval);
                activeTimerInterval = null;
            }
            
            // å…³é—­å½“å‰ä»»åŠ¡æ¨¡æ€æ¡†
            taskModal.classList.remove('active');
            isTaskActive = false;
            
            // ä¸æ‰£é™¤é‡‘å¸ï¼Œç›´æ¥é‡æ–°å¼€å§‹æŠ½å¥–
            // æ‹‰æ†åŠ¨ç”»
            leverArm.classList.add('pulled');
            setTimeout(() => {
                leverArm.classList.remove('pulled');
                leverArm.classList.add('releasing');
                setTimeout(() => leverArm.classList.remove('releasing'), 600);
            }, 300);

            // é‡æ–°å¼€å§‹æŠ½å¥–
            startSpin();
        }

        // --- å·¥å…·å‡½æ•°ï¼šä»æ–‡æœ¬ä¸­æå–æ—¶é—´ï¼ˆç§’æ•°ï¼‰ ---
        function extractTimeFromText(text) {
            // åŒ¹é…å„ç§æ—¶é—´æ ¼å¼ï¼šXç§’ã€Xåˆ†é’Ÿã€Xåˆ†ã€X minã€X secç­‰
            let totalSeconds = 0;
            
            // æ£€æŸ¥åˆ†é’Ÿ
            const minuteMatches = text.match(/(\d+)\s*(åˆ†é’Ÿ|åˆ†|min)/g);
            if (minuteMatches) {
                minuteMatches.forEach(match => {
                    const minutes = parseInt(match.match(/\d+/)[0]);
                    totalSeconds += minutes * 60;
                });
            }
            
            // æ£€æŸ¥ç§’
            const secondMatches = text.match(/(\d+)\s*(ç§’|sec)/g);
            if (secondMatches) {
                secondMatches.forEach(match => {
                    const seconds = parseInt(match.match(/\d+/)[0]);
                    totalSeconds += seconds;
                });
            }
            
            return totalSeconds > 0 ? totalSeconds : null;
        }

        // --- 3.1 è¿·ä½ æ¸¸æˆå®ç° ---
        
        // æ‹¼å›¾ (ç®€åŒ–ç‰ˆï¼šç‚¹å‡»äº¤æ¢ä¸¤ä¸ªå›¾ç‰‡å—)
        function initPuzzleGame() {
            const imgUrl = `https://picsum.photos/240/240?random=${Date.now()}`;
            const grid = document.createElement('div');
            grid.className = 'puzzle-grid';
            
            // ç”Ÿæˆ9ä¸ªå—
            let positions = [0,1,2,3,4,5,6,7,8];
            // éšæœºæ‰“ä¹±
            positions.sort(() => Math.random() - 0.5);
            
            let selectedPiece = null;
            let solvedCount = 0; // ç®€å•åˆ¤æ–­ï¼Œè¿™é‡Œåªè¦ç©å‡ æ­¥å°±ç»™è¿‡ï¼Œä¸ºäº†ä¸è®©ç”¨æˆ·æŒ«è´¥

            positions.forEach((pos, index) => {
                const piece = document.createElement('div');
                piece.className = 'puzzle-piece';
                // è®¡ç®—èƒŒæ™¯ä½ç½®
                const x = (pos % 3) * -80;
                const y = Math.floor(pos / 3) * -80;
                piece.style.backgroundImage = `url(${imgUrl})`;
                piece.style.backgroundPosition = `${x}px ${y}px`;
                piece.dataset.currentIdx = index; // åªæ˜¯æ ‡è®°

                piece.onclick = () => {
                    if (!selectedPiece) {
                        selectedPiece = piece;
                        piece.style.opacity = '0.5';
                    } else {
                        // äº¤æ¢èƒŒæ™¯
                        const tempBg = selectedPiece.style.backgroundPosition;
                        selectedPiece.style.backgroundPosition = piece.style.backgroundPosition;
                        piece.style.backgroundPosition = tempBg;
                        
                        selectedPiece.style.opacity = '1';
                        selectedPiece = null;
                        
                        // åªè¦äº¤æ¢äº†3æ¬¡ä»¥ä¸Šå°±å…è®¸å®Œæˆ (é™ä½éš¾åº¦ï¼Œæ¯•ç«Ÿç›®çš„æ˜¯å¤šå·´èƒº)
                        solvedCount++;
                        if (solvedCount >= 3) {
                            finishBtn.style.display = 'inline-block';
                            finishBtn.innerText = "æ‹¼å¾—ä¸é”™ï¼(å®Œæˆ)";
                        }
                    }
                };
                grid.appendChild(piece);
            });
            
            gameContent.appendChild(grid);
            const hint = document.createElement('div');
            hint.innerText = "ç‚¹å‡»ä¸¤ä¸ªæ–¹å—äº¤æ¢ä½ç½®ï¼Œè¿˜åŸå›¾ç‰‡ (æˆ–å°è¯•äº¤æ¢3æ¬¡)";
            hint.style.fontSize = "0.9rem";
            hint.style.color = "#666";
            hint.style.marginTop = "10px";
            gameContent.appendChild(hint);
        }

        // è®°å¿†ç¿»ç‰Œ (4x2 ç®€å•ç‰ˆ)
        function initMemoryGame() {
            const emojis = ['ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹'];
            let cards = [...emojis, ...emojis];
            cards.sort(() => Math.random() - 0.5);
            
            const grid = document.createElement('div');
            grid.className = 'memory-grid';
            
            let flippedCards = [];
            let matchedPairs = 0;

            cards.forEach(emoji => {
                const card = document.createElement('div');
                card.className = 'memory-card';
                card.dataset.emoji = emoji;
                
                card.onclick = () => {
                    if (card.classList.contains('flipped') || flippedCards.length >= 2) return;
                    
                    card.classList.add('flipped');
                    card.innerText = emoji;
                    flippedCards.push(card);

                    if (flippedCards.length === 2) {
                        setTimeout(() => {
                            if (flippedCards[0].dataset.emoji === flippedCards[1].dataset.emoji) {
                                flippedCards[0].classList.add('matched');
                                flippedCards[1].classList.add('matched');
                                matchedPairs++;
                                if (matchedPairs === 4) {
                                    finishBtn.style.display = 'inline-block';
                                }
                            } else {
                                flippedCards[0].classList.remove('flipped');
                                flippedCards[0].innerText = '';
                                flippedCards[1].classList.remove('flipped');
                                flippedCards[1].innerText = '';
                            }
                            flippedCards = [];
                        }, 800);
                    }
                };
                grid.appendChild(card);
            });
            gameContent.appendChild(grid);
        }

        // è®¡æ—¶ä»»åŠ¡
        function initTimerTask(instruction, seconds) {
            gameContent.innerHTML = `<div style="font-size:1.2rem; margin-bottom:20px;">${instruction}</div>`;
            const timerDiv = document.createElement('div');
            timerDiv.className = 'timer-circle';
            timerDiv.innerText = seconds;
            gameContent.appendChild(timerDiv);
            
            const startBtn = document.createElement('button');
            startBtn.innerText = "å¼€å§‹è®¡æ—¶";
            startBtn.style.marginTop = "20px";
            startBtn.onclick = () => {
                startBtn.disabled = true;
                timerDiv.style.animationPlayState = 'running';
                let left = seconds;
                const interval = setInterval(() => {
                    left--;
                    timerDiv.innerText = left;
                    if (left <= 0) {
                        clearInterval(interval);
                        timerDiv.style.animationPlayState = 'paused';
                        timerDiv.innerText = "âœ¨";
                        finishBtn.style.display = 'inline-block';
                    }
                }, 1000);
            };
            gameContent.appendChild(startBtn);
        }

        // ç®€å•ç¡®è®¤ä»»åŠ¡ï¼ˆè‡ªåŠ¨æ£€æµ‹æ—¶é—´å¹¶æ˜¾ç¤ºå€’è®¡æ—¶å™¨ï¼‰
        function initCheckTask(text, delaySeconds) {
            // å…ˆå°è¯•ä»æ–‡æœ¬ä¸­æå–æ—¶é—´
            const extractedTime = extractTimeFromText(text);
            const taskTime = extractedTime || delaySeconds;
            
            // æ˜¾ç¤ºä»»åŠ¡æ–‡æœ¬
            const textDiv = document.createElement('div');
            textDiv.style.fontSize = '1.2rem';
            textDiv.style.padding = '20px';
            textDiv.style.marginBottom = '20px';
            textDiv.innerText = text;
            gameContent.appendChild(textDiv);
            
            // å¦‚æœæ£€æµ‹åˆ°æ—¶é—´ï¼Œæ˜¾ç¤ºå€’è®¡æ—¶å™¨
            if (extractedTime && extractedTime > 0) {
                const timerContainer = document.createElement('div');
                timerContainer.style.display = 'flex';
                timerContainer.style.flexDirection = 'column';
                timerContainer.style.alignItems = 'center';
                timerContainer.style.marginTop = '20px';
                
                const timerLabel = document.createElement('div');
                timerLabel.style.fontSize = '1rem';
                timerLabel.style.color = '#666';
                timerLabel.style.marginBottom = '10px';
                timerLabel.innerText = 'å€’è®¡æ—¶';
                timerContainer.appendChild(timerLabel);
                
                const timerCircle = document.createElement('div');
                timerCircle.className = 'timer-circle';
                timerCircle.style.width = '120px';
                timerCircle.style.height = '120px';
                timerCircle.style.fontSize = '2rem';
                timerCircle.style.fontWeight = 'bold';
                timerCircle.style.color = 'var(--machine-color)';
                timerCircle.innerText = extractedTime;
                timerContainer.appendChild(timerCircle);
                
                const startBtn = document.createElement('button');
                startBtn.innerText = 'å¼€å§‹è®¡æ—¶';
                startBtn.style.marginTop = '20px';
                startBtn.style.padding = '10px 30px';
                startBtn.style.borderRadius = '10px';
                startBtn.style.border = 'none';
                startBtn.style.background = '#2ed573';
                startBtn.style.color = 'white';
                startBtn.style.fontSize = '1.1rem';
                startBtn.style.cursor = 'pointer';
                startBtn.style.transition = 'transform 0.2s';
                
                startBtn.onmouseover = () => startBtn.style.transform = 'scale(1.05)';
                startBtn.onmouseout = () => startBtn.style.transform = 'scale(1)';
                
                startBtn.onclick = () => {
                    startBtn.disabled = true;
                    startBtn.style.opacity = '0.6';
                    startBtn.style.cursor = 'not-allowed';
                    timerCircle.style.animationPlayState = 'running';
                    
                    let left = extractedTime;
                    // æ¸…ç†ä¹‹å‰çš„å®šæ—¶å™¨ï¼ˆå¦‚æœæœ‰ï¼‰
                    if (activeTimerInterval) {
                        clearInterval(activeTimerInterval);
                    }
                    
                    activeTimerInterval = setInterval(() => {
                        left--;
                        timerCircle.innerText = left;
                        
                        if (left <= 0) {
                            clearInterval(activeTimerInterval);
                            activeTimerInterval = null;
                            timerCircle.style.animationPlayState = 'paused';
                            timerCircle.innerText = 'âœ¨';
                            timerCircle.style.color = '#2ed573';
                            timerLabel.innerText = 'å®Œæˆï¼';
                            finishBtn.style.display = 'inline-block';
                        }
                    }, 1000);
                };
                
                timerContainer.appendChild(startBtn);
                gameContent.appendChild(timerContainer);
            } else {
                // å¦‚æœæ²¡æœ‰æ£€æµ‹åˆ°æ—¶é—´ï¼Œä½¿ç”¨åŸæ¥çš„å»¶è¿Ÿæ–¹å¼
                setTimeout(() => {
                    finishBtn.style.display = 'inline-block';
                }, delaySeconds * 1000);
            }
        }

        // --- 4. å®Œæˆä¸åé¦ˆ ---
        function closeTask() {
            // æ¸…ç†å€’è®¡æ—¶å™¨
            if (activeTimerInterval) {
                clearInterval(activeTimerInterval);
                activeTimerInterval = null;
            }
            
            taskModal.classList.remove('active');
            isTaskActive = false;
            updateUI(); // æ›´æ–°ç¯å…‰çŠ¶æ€
            triggerConfetti();
        }

        function triggerConfetti() {
            const count = 200;
            const defaults = { origin: { y: 0.7 } };

            function fire(particleRatio, opts) {
                confetti(Object.assign({}, defaults, opts, {
                    particleCount: Math.floor(count * particleRatio)
                }));
            }

            fire(0.25, { spread: 26, startVelocity: 55 });
            fire(0.2, { spread: 60 });
            fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
            fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
            fire(0.1, { spread: 120, startVelocity: 45 });
        }

    </script>
</body>
</html>
